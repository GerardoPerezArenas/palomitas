 /* Generated by Together */

package es.altia.agora.business.administracion.persistence.manual;

import es.altia.agora.business.administracion.GestionValueObject;
import es.altia.agora.business.administracion.HorarioCentroValueObject;
import es.altia.agora.business.administracion.exception.GestionException;
import es.altia.agora.technical.Fecha;
import es.altia.common.exception.*;
import es.altia.common.service.config.*;
import es.altia.common.service.jdbc.*;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import es.altia.util.conexion.*;

import java.sql.*;

import java.util.Vector;

 public class CalendarioGeneralDAO {

     /**
      * Construye una nueva CalendarioGeneralDAO. Es protected, por lo que la unica manera de instanciar esta clase
      * es usando el factory method <code>getInstance</code>
      */
     protected CalendarioGeneralDAO() {
         super();
         //Queremos usar el fichero de configuracion techserver
         m_ConfigTechnical = ConfigServiceHelper.getConfig("techserver");
         //Queremos tener acceso a los mensajes de error localizados
         m_ConfigError = ConfigServiceHelper.getConfig("error");
     }

/////////////////////////////////////CALENDARIO GENERAL///////////////////////////////////////
     /**
      * Obtiene todos los dias festivos del calendario laboral general
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerFestivos(GestionValueObject laGestion,String[] params) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener festivos");
         m_Log.debug("entra en obtenerFestivos del DAO");

         Connection con = null;
         Statement st = null;
         ResultSet rs = null;
         AdaptadorSQLBD oad = null;
         Vector festivos = new Vector();

         try {
           oad = new AdaptadorSQLBD(params);
           con = oad.getConnection();
           st = con.createStatement();

            String sql = "SELECT "+oad.convertir("GEN_CAL_DIA",AdaptadorSQL.CONVERTIR_COLUMNA_TEXTO,"YYYY-MM-DD") +" AS GEN_CAL_DIA FROM GEN_CALENDARIO ORDER BY 1";
            if(m_Log.isDebugEnabled()) m_Log.debug(sql);

            rs = st.executeQuery(sql);

            while(rs.next())
               festivos.addElement(rs.getString(m_ConfigTechnical.getString("SQL.gen_calendario_general.dia")));

            laGestion.setLista_festivos_generales(festivos);

            rs.close();
            st.close();

            m_Log.debug("Obtenidos los dias festivos");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioGeneral.ObtenerFestivos"), e);
           } finally {
             try{
               oad.devolverConexion(con);
             } catch(Exception ex) {
               ex.printStackTrace();
               m_Log.error("Exception: " + ex.getMessage());
             }
           }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias festivos");
     }

     public Vector obtenerFestivosPorAno(String ano, String[] params) throws GestionException, TechnicalException {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtenerFestivosPorAno");

         Connection con = null;
         AdaptadorSQLBD oad = null;

         try {
             oad = new AdaptadorSQLBD(params);
             con = oad.getConnection();
             return obtenerFestivosPorAno(ano, con, oad);

         } catch (Exception e) {
             //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
             m_Log.error(e.getMessage());
             throw new GestionException(m_ConfigError.getString("Error.CalendarioGeneral.ObtenerFestivos"), e);
         } finally {
             try {
                 oad.devolverConexion(con);
             } catch (Exception ex) {
                 ex.printStackTrace();
                 m_Log.error("Exception: " + ex.getMessage());
             }
         }
     }
     
     public Vector obtenerFestivosPorAno(String ano, Connection con, AdaptadorSQL oad) throws GestionException, TechnicalException {

         Statement st = null;
         ResultSet rs = null;
         Vector festivos = new Vector();

         try {
             st = con.createStatement();

             String sql = "SELECT " + oad.convertir(m_ConfigTechnical.getString("SQL.gen_calendario_general.dia"), AdaptadorSQLBD.CONVERTIR_COLUMNA_TEXTO, "DD/MM/YYYY") +
                     " AS " + m_ConfigTechnical.getString("SQL.gen_calendario_general.dia") +
                     " FROM GEN_CALENDARIO WHERE " + m_ConfigTechnical.getString("SQL.gen_calendario_general.ano") +
                     "=" + ano;
             if (m_Log.isDebugEnabled()) {
                 m_Log.debug(sql);
             }

             rs = st.executeQuery(sql);

             while (rs.next()) {
                 festivos.addElement(rs.getString(m_ConfigTechnical.getString("SQL.gen_calendario_general.dia")));
             }

             rs.close();
             st.close();

             m_Log.debug("Obtenidos los dias festivos");

         } catch (Exception e) {
             //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
             m_Log.error(e.getMessage());
             throw new GestionException(m_ConfigError.getString("Error.CalendarioGeneral.ObtenerFestivos"), e);
         } 

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias festivos");
         return festivos;
     }


     /**
      * Elimina todos los dias festivos del calendario laboral general
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void eliminarFestivos(String[] params) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("eliminar festivos");

         AdaptadorSQLBD abd = null;
         Connection conexion = null;
         ResultSet rs = null;
         int res = 0;

         try {
           m_Log.debug("A por el OAD");
           abd = new AdaptadorSQLBD(params);
           m_Log.debug("A por la conexion");
           conexion = abd.getConnection();

           String sql = "DELETE FROM GEN_CALENDARIO";
           if(m_Log.isDebugEnabled()) m_Log.debug(sql);
           PreparedStatement ps = conexion.prepareStatement(sql);
           res = ps.executeUpdate();
           m_Log.debug("las filas afectadas en el DELETE de eliminar festivos son :::::::::::::: : " + res);

           m_Log.debug("Eliminados los dias festivos");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioGeneral.GrabarFestivos"), e);
           } finally {
             try{
               abd.devolverConexion(conexion);
             } catch(Exception ex) {
               ex.printStackTrace();
               m_Log.error("Exception: " + ex.getMessage());
             }
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Eliminados los dias festivos");
     }

     /**
      * Graba todos los dias festivos del calendario laboral general
      * @param     Vector festivos
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void grabarFestivos(Vector festivos,String[] params) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("grabar festivos");

         AdaptadorSQLBD abd = null;
         Connection conexion = null;
         ResultSet rs = null;
	     PreparedStatement ps = null;
		 String sql = null;

         int i=0;
         String ano;
         String  fecha;
         int res = 0;

         try {
           m_Log.debug("A por el OAD");
           abd = new AdaptadorSQLBD(params);
           m_Log.debug("A por la conexion");
           conexion = abd.getConnection();

            while( i<festivos.size() ){

               ano= festivos.elementAt(i).toString().substring(6);
               fecha = festivos.elementAt(i).toString();
               sql = "INSERT INTO GEN_CALENDARIO ( GEN_CAL_ANO, GEN_CAL_DIA) VALUES (" +
                          ano + ","+abd.convertir("'"+fecha+"'",AdaptadorSQL.CONVERTIR_COLUMNA_FECHA,"DD/MM/YYYY")+ ")";


               if(m_Log.isDebugEnabled()) m_Log.debug(sql);
               ps = conexion.prepareStatement(sql);
               res = ps.executeUpdate();
               m_Log.debug("las filas afectadas en el INSERT de festivos son :::::::::::::: : " + res);

			   ps.close();
               i++;
            }

            m_Log.debug("Grabados los dias festivos");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioGeneral.GrabarFestivos"), e);
           } finally {
             try{
			   if(ps != null) ps.close();
               abd.devolverConexion(conexion);
             } catch(Exception ex) {
               ex.printStackTrace();
               m_Log.error("Exception: " + ex.getMessage());
             }
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Grabados los dias festivos");
     }

//////////////////////////////////CALENDARIO POR CENTRO//////////////////////////////
     /**
      * Obtiene todos los dias festivos del centro
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerFestivosCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener festivos de centro");

         //Queremos obtener el parametro que indica el numero maximo de dias
         //festivos que puede tener un centro aparte de los festivos generales.
         m_ConfigTechnical = ConfigServiceHelper.getConfig("langai");
         String maxFestivosCentro = m_ConfigTechnical.getString("maximo_de_dias_festivos_por_centro");
         laGestion.setMaxFestivosCentro(maxFestivosCentro);
         m_ConfigTechnical = ConfigServiceHelper.getConfig("techserver");

         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
         JDBCWrapper sqlExec = new JDBCWrapper();

         Vector festivos = new Vector();
         Vector params = new Vector();

         try {

            String sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.obtenerFestivos");

            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            sqlExec.execute(sql, params);

            while(sqlExec.next())
               festivos.addElement(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_calendario_centro.dia")));

            laGestion.setLista_festivos_centro(festivos);

            m_Log.debug("Obtenidos los dias festivos de centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerFestivos"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias festivos de centro");
     }

     /**
      * Obtiene todos los dias de vacaciones del centro
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerVacacionesCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener festivos de centro");

         //Queremos obtener el parametro que indica el numero maximo de dias
         //estivales que puede tener un centro.
         m_ConfigTechnical = ConfigServiceHelper.getConfig("langai");
         String maxVacacionesCentro = m_ConfigTechnical.getString("maximo_de_dias_estivales_por_centro");
         laGestion.setMaxVacacionesCentro(maxVacacionesCentro);
         m_ConfigTechnical = ConfigServiceHelper.getConfig("techserver");

         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
         JDBCWrapper sqlExec = new JDBCWrapper();

         Vector festivos = new Vector();
         Vector params = new Vector();

         try {
            String sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.obtenerVacaciones");
            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            sqlExec.execute(sql, params);

            while(sqlExec.next())
               festivos.addElement(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_calendario_centro.dia")));

            laGestion.setLista_vacaciones_centro(festivos);

            m_Log.debug("Obtenidos los dias estivales de este centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerVacaciones"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias estivales de este centro");
     }


     /**
      * Obtiene la lista de los dias ocupados
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerListaDiasOcupados(GestionValueObject laGestion,String[] params) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener lista de dias ocupados");

         Connection con = null;
         Statement st;
         ResultSet rs;
         AdaptadorSQLBD oad = null;
         Vector dias_ocupados = new Vector();

         try {
           oad = new AdaptadorSQLBD(params);
           con = oad.getConnection();
           st = con.createStatement();

           String sql = "SELECT DISTINCT "+oad.convertir("GEN_AGE_FECHA",AdaptadorSQL.CONVERTIR_COLUMNA_TEXTO,"YYYY-MM-DD")+ " AS GEN_AGE_FECHA FROM GEN_AGENDA_DETALLE " +
                        "WHERE  ( GEN_AGE_CITAS_IR <> 0 OR GEN_AGE_CITAS_MMR <> 0 )";
           if(m_Log.isDebugEnabled()) m_Log.debug(sql);

            rs = st.executeQuery(sql);

            while(rs.next()) {
              if (m_Log.isDebugEnabled()) m_Log.debug("la fecha es : " + m_ConfigTechnical.getString("SQL.gen_agenda_detalle.fecha"));
              dias_ocupados.addElement(rs.getString(m_ConfigTechnical.getString("SQL.gen_agenda_detalle.fecha")));
              if (m_Log.isDebugEnabled()) m_Log.debug("el tamaño del vector de dias_ocupados es : " + dias_ocupados.size());
            }

            laGestion.setLista_dias_ocupados(dias_ocupados);

            m_Log.debug("Obtenidos los dias ocupados de este centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerListaDiasOcupados"), e);
         } finally {
             try{
               oad.devolverConexion(con);
             } catch(Exception ex) {
               ex.printStackTrace();
               m_Log.error("Exception: " + ex.getMessage());
             }
          }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias ocupados de este centro");
     }


     /**
      * Obtiene la lista de los dias ocupados de un centro
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerListaDiasOcupadosCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener lista de dias ocupados del centro");

         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
         JDBCWrapper sqlExec = new JDBCWrapper();

         Vector dias_ocupados = new Vector();
         Vector params = new Vector();

         try {
            String sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.obtenerDiasOcupadosCentro");
            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            sqlExec.execute(sql, params);

            while(sqlExec.next())
               dias_ocupados.addElement(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_agenda_detalle.fecha")));

            laGestion.setLista_dias_ocupados(dias_ocupados);

            m_Log.debug("Obtenidos los dias ocupados de este centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerListaDiasOcupados"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias ocupados de este centro");
     }


     /**
      * Obtiene la lista de los dias ocupados de un centro para el horario
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerListaDiasOcupadosCentroParaHorario(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener lista de dias ocupados del centro");

         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
         JDBCWrapper sqlExec = new JDBCWrapper();

         Vector dias_ocupados = new Vector();
         Vector params = new Vector();

         try {
            String sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.obtenerDiasOcupadosCentro");
            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            sqlExec.execute(sql, params);

            while(sqlExec.next())
               dias_ocupados.addElement(Fecha.obtenerString(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_agenda_detalle.fecha"))));
               laGestion.setLista_dias_ocupados(dias_ocupados);

            m_Log.debug("Obtenidos los dias ocupados de este centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerListaDiasOcupados"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenidos los dias ocupados de este centro");
     }


     /**
      * Elimina todos los dias festivos y estivales del calendario laboral de centro
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void eliminarFestivosCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("eliminar festivos y estivales del centro");

         //Usar el XAJDBCWrapper es mas sencillo que usar JDBC directamente
         XAJDBCWrapper sqlExec = new XAJDBCWrapper();

         Vector params = new Vector();

         try {
            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            String sql = "DELETE FROM GEN_CALENDARIO";

            sqlExec.execute(sql,params);

            m_Log.debug("Eliminados los dias festivos y estivales del centro");


         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.GrabarFestivos"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Eliminados los dias festivos y estivales del centro");
     }

//  /**
//      * Obtiene la lista de las horas ocupadas de un centro
//      * @param     GestionValueObject
//      * @exception GestionException si existe algun problema tecnico.
//      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
//      */
//     public void obtenerListaHorasOcupadasCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
//     {
//         //Queremos estar informados de cuando este metod es ejecutado
//         m_Log.debug("obtener lista de horas ocupadas del centro");
//
//         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
//         JDBCWrapper sqlExec = new JDBCWrapper();
//
//         Vector horas_ocupadas = new Vector();
//         // Vector d_ocupados = new Vector();
//         Vector params = new Vector();
//
//         HorarioCentroValueObject elHorarioCentro2;
//
//         try {
//            String sql = m_ConfigTechnical.getString("SQL.gen_horario_centro.obtenerHorasOcupadasCentro");
//            params.addElement(laGestion.getCentro());
//            params.addElement(laGestion.getUbicacion());
//
//            sqlExec.execute(sql, params);
//
//            String horaFecha ="";
//
//            while(sqlExec.next()){
//               horaFecha = Fecha.obtenerString(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_agenda_detalle.fecha"))) +
//                           sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_agenda_detalle.hora"));
//
//               horas_ocupadas.addElement(horaFecha);
//            }
//
//           for (int i=0; i<horas_ocupadas.size(); i++) {
//                if (m_Log.isDebugEnabled()) m_Log.debug("1*"+(String)horas_ocupadas.elementAt(i));
//           }
//           laGestion.setLista_horas_ocupadas(horas_ocupadas);
//
//            m_Log.info("Obtenidas los horas ocupados de este centro");
//
//         } catch (Exception e){
//              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
//              m_Log.error(e.getMessage());
//              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.ObtenerListaHorasOcupadas"), e);
//           } finally {
//               sqlExec.close();
//             }
//
//         //Queremos estar informados de cuando este metodo ha finalizado
//         m_Log.debug("Obtenidas las horas ocupadas de este centro");
//     }

     /**
      * Graba todos los dias festivos y estivales del calendario laboral del centro
      * @param Vector festivosCentro, Vector vacacionesCentro, GestionValueObject laGestion
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void grabarFestivosCentro(Vector festivosCentro, Vector vacacionesCentro, GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("grabar festivos y estivales del centro");

         //Usar el XAJDBCWrapper es mas sencillo que usar JDBC directamente
         XAJDBCWrapper sqlExec = new XAJDBCWrapper();

         int i=0;
         Integer ano;
         String  fecha;

         try {
            Vector params;
            String codCentro = laGestion.getCentro();
            String codUbicacion = laGestion.getUbicacion();

            String sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.grabarFestivosCentro");

            while( i<festivosCentro.size() ){
               params = new Vector();

               ano= Integer.valueOf(festivosCentro.elementAt(i).toString().substring(6));
               fecha = festivosCentro.elementAt(i).toString();

               params.addElement(codCentro);
               params.addElement(codUbicacion);
               params.addElement(ano);
               params.addElement(fecha);

               sqlExec.execute(sql, params);
               i++;
            }

            i=0;
            sql = m_ConfigTechnical.getString("SQL.gen_calendario_centro.grabarVacacionesCentro");

            while( i<vacacionesCentro.size() ){
               params = new Vector();

               ano= Integer.valueOf(vacacionesCentro.elementAt(i).toString().substring(6));
               fecha = vacacionesCentro.elementAt(i).toString();

               params.addElement(codCentro);
               params.addElement(codUbicacion);
               params.addElement(ano);
               params.addElement(fecha);

               sqlExec.execute(sql, params);
               i++;
            }

            m_Log.debug("Grabados los dias festivos y estivales del centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.CalendarioCentro.GrabarFestivos"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Grabados los dias festivos y estivales del centro");
     }


////////////////////////////////////HORARIO POR CENTRO///////////////////////////
     /**
      * Obtiene el horario laboral del centro
      * @param     GestionValueObject
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void obtenerHorarioCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("obtener festivos de centro");

         //Usar el JDBCWrapper es mas sencillo que usar JDBC directamente
         JDBCWrapper sqlExec = new JDBCWrapper();

         Vector params = new Vector();
         Vector horario_normal = new Vector();
         Vector horario_especial = new Vector();
         HorarioCentroValueObject elHorarioCentro;

         try {

            String sql = m_ConfigTechnical.getString("SQL.gen_horario_centro.obtenerHorarioNormal");

            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            sqlExec.execute(sql, params);

            if(sqlExec.next()){
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_ini")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_fin")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_ini_T"))     == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_ini_T")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_fin_T"))     == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_fin_T")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_ini"))   == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_ini")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_fin"))   == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_fin")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_ini_T")) == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_ini_T")));
               horario_normal.addElement(sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_fin_T")) == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_centros_ubicaciones.hora_sab_fin_T")));
            }

            laGestion.setHorario_normal(horario_normal);

            sql = m_ConfigTechnical.getString("SQL.gen_horario_centro.obtenerHorarioEspecial");
            sqlExec.execute(sql, params);

            while(sqlExec.next()){
               elHorarioCentro = new HorarioCentroValueObject(
                                     Fecha.obtenerString(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.fecha_ini"))),
                                     Fecha.obtenerString(sqlExec.getDate(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.fecha_fin"))),
                                     sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_ini_m")),
                                     sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_fin_m")),
                                     sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_ini_t")) == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_ini_t")),
                                     sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_fin_t")) == null ? "" : sqlExec.getString(m_ConfigTechnical.getString("SQL.gen_horario_ubicac.hora_fin_t"))  );

               horario_especial.addElement(elHorarioCentro);
            }

            laGestion.setHorario_especial(horario_especial);

            m_Log.debug("Obtenido el horario del centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.HorarioCentro.ObtenerHorario"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Obtenido el horario del centro");
     }

     /**
      * Elimina el horario laboral de este centro
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void eliminarHorarioCentro(GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("eliminar horario del centro");

         //Usar el XAJDBCWrapper es mas sencillo que usar JDBC directamente
         XAJDBCWrapper sqlExec = new XAJDBCWrapper();

         Vector params = new Vector();

         try {
            params.addElement(laGestion.getCentro());
            params.addElement(laGestion.getUbicacion());

            String sql = m_ConfigTechnical.getString("SQL.gen_horario_centro.deleteHorarioCentro");

            sqlExec.execute(sql,params);

            m_Log.debug("Eliminado el horario laboral del centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.HorarioCentro.grabarHorario"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Eliminado el horario laboral del centro");
     }

     /**
      * Graba el horario laboral del centro
      * @param Vector losHorarioCentro, GestionValueObject laGestion
      * @exception GestionException si existe algun problema tecnico.
      * @exception TechnicalException si hay algun problema tecnico usando los servicios del framework.
      */
     public void grabarHorarioCentro(Vector losHorarioCentro, GestionValueObject laGestion) throws GestionException, TechnicalException
     {
         //Queremos estar informados de cuando este metod es ejecutado
         m_Log.debug("grabar horario laboral del centro");

         //Usar el XAJDBCWrapper es mas sencillo que usar JDBC directamente
         XAJDBCWrapper sqlExec = new XAJDBCWrapper();

         int i=0;

         try {
            Vector params;
            String codCentro = laGestion.getCentro();
            String codUbicacion = laGestion.getUbicacion();

            String sql = m_ConfigTechnical.getString("SQL.gen_horario_centro.grabarHorarioCentro");

            while( i<losHorarioCentro.size() ){
               params = new Vector();

               params.addElement(codCentro);
               params.addElement(codUbicacion);
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getFecha_inicio());
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getFecha_fin());
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getHora_inicio_m());
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getHora_fin_m());
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getHora_inicio_t());
               params.addElement(((HorarioCentroValueObject)losHorarioCentro.elementAt(i)).getHora_fin_t());

               sqlExec.execute(sql, params);
               i++;
            }

            m_Log.debug("Grabado el horario laboral del centro");

         } catch (Exception e){
              //Si la eliminacion va mal tenemos que lanzar y loggear la excepcion
              m_Log.error(e.getMessage());
              throw new GestionException(m_ConfigError.getString("Error.HorarioCentro.grabarHorario"), e);
           } finally {
                if (sqlExec!=null) sqlExec.close();
             }

         //Queremos estar informados de cuando este metodo ha finalizado
         m_Log.debug("Grabado el horario laboral del centro");
     }



     /**
      * Factory method para el<code>Singelton</code>.
      * @return La unica instancia de ExperienciaDAO The only CustomerDAO instance.
      */
     public static CalendarioGeneralDAO getInstance() {
         //si no hay ninguna instancia de esta clase tenemos que crear una

         // Necesitamos sincronizacion para serializar (no multithread)
         // Las invocaciones de este metodo
         synchronized (CalendarioGeneralDAO.class) {
             if (instance == null) {
                 instance = new CalendarioGeneralDAO();
             }
         }

         return instance;
     }



     // Mi propia instancia. Usada en el metodo getInstance
     private static CalendarioGeneralDAO instance = null;


     // Declaracion de servicios
     protected static Config m_ConfigTechnical; //Para el fichero de configuracion tecnico
     protected static Config m_ConfigError; //Para los mensajes de error localizados
     protected static Log m_Log =
          LogFactory.getLog(CalendarioGeneralDAO.class.getName());

 }